The performance of the Lepton infrared camera was the largest unknown when starting this project, so much of our testing methods revolved around rapidly implementing basic functionality, testing, then adding additional functionality with each testing iteration. Several large testing excursions were used to try to implement as much as possible in one integrated system.


\subsubsection{\label{sec:discussion:testing:testrig1}Test Rig 1.0}

Test Rig 1.0 was the first testing excursion of the term. The goal of this testing round was to implement basic Lepton functionality (image capture, scaling from 16-bit images to the more standard 8-bit, and video encoding) along with the communication protocols so that the Raspberry Pi in the test rig's box wirelessly backed up the data to another computer on board. The Test Rig 1.0 was then taken to Ucluelet over Reading Week (February 15-19, 2015). Brian Congdon of Subtidal Adventures, a whale-watching company in Ucluelet, took us out for close to 8 hours of total time at sea over two days, taking us on close drive-bys of bouys, logs, boats and marine life. As we approached each obstacle, the captain would read out the our distance using the onboard radar system which we would then timestamp into each recording; this lets us play back through the footage we captured and interpolate the distance to the obstacle at each point in time. Pairing this with time readouts of when our obstacle detection code first positively identifies an object, we know the approximate distance at which our code identifies various obstacles. With the test rig strapped to the front of the boat, this outing gave us a massive amount of invaluable footage, guiding the development of Test Rig 2.0 and giving insight into the final rig design. Results from this outing, as well as the others, will be shown and discussed in the Results section of this paper.

\begin{figure}[h]
\centering
\includegraphics[width=0.7\textwidth]{"./image/testrig1_front"}
\caption{Front of Test Rig 1.0}
\label{fig:testrig1_testing}
\end{figure}


\subsubsection{\label{sec:discussion:testing:testrig2}Test Rig 2.0 and Obstacle Detection}

Running in parallel to the development of Test Rig 2.0 was the building of the overall software architecture and the obstacle detection software. Using video data gathered on the Ucluelet trip, many different filtering, thresholding, line finding and pattern recognition functions were experimented with and tested. The pipeline and initial functionality of the object detection software was developed for March 14, 2015 when the Sailbot team held their Sync-the-Boat hackathon. However, much of the object detection development was paused on March 21 when our presentation of our obstacle detection system won the top prize among oral presentations at UBC's Multidisciplinary Undergraduate Research Conference. As a direct result of this prize we acquired several new sponsorships, opening the door to the possibility of buying a higher-quality camera (such as the FLIR Quark2, the best model of which has a 640x 512 resolution). Since cameras of this quality would drastically improve our detection range and accuracy, but the detection software would need entirely different functions from those used for the Lepton, much of our software focus shifted to evaluating the capabilites of the Quark2 and the Raspberry Pi's ability to process images at higher resolutions.

\begin{figure}[h]
\centering
\begin{subfigure}{0.4\textwidth}
 \centering
 \includegraphics[width=0.95\textwidth, angle= 180]{"./image/testrig2_top"}
 \caption{Top-down view.}
 \label{fig:testrig2_testing:sub1}
\end{subfigure}
\begin{subfigure}{0.4\textwidth}
 \centering
 \includegraphics[width=0.95\textwidth, angle= 180]{"./image/testrig2_interior"}
 \caption{The interior structure, with the RPi, Discovery Board, and Lepton (in housing) in view.}
 \label{fig:testrig2_testing:sub2}
\end{subfigure}
\caption{Test Rig 2.0.}
\label{fig:testrig2_testing}
\end{figure}

The second main outing took place on Wednesday, April 1, 2015. With the Test Rig 2.0, in which we had developed more advanced Lepton functionality (in the form of controllable video scaling, more advanced correction algorithms and general bug-fixing), a solid internal structuring, and implemented an STM32 Discovery board to act as an interial measurement unit (IMU). Stamping every gathered frame with a 9 degree of freedom IMU readout (accelerometer, gyroscope, and magnetometer) gave us a database to use when we implement horizon-finding and orientation tracking from IMU data; this is one of the ongoing commitments. These tests were performed on a boat taken out in North Vancouver.


\subsubsection{\label{sec:discussion:testing:testrig3}Final Rig}
The final version of the obstacle detection system, the one which will be placed on board the Sailbot, will take a drastically different physical form from the test rigs. While the test rigs held the Raspberry Pi, battery, Lepton, and IMU all in one casing, on the final rig ideally only the lepton is mounted high on a tripod at the front of the boat while the rest of the electronics are in a secure compartment in the hull. This limits the weight at the top of the tripod, reducing the induced moment and minimizing the effect on the original mechanical design specs (which did not anticipate any obstacle detection systems). In addition, the final rig must be durable and resistant to sea water damage, incorporating a solid IR-transparent window and some method to combat salt buildup. To ensure the success of this distributed design, testing already performed has demonstrated that Lepton can interface with the Raspberry Pi over long cables, up to 3 meters in length.

The final rig is, at the time of writing this report, still in the design stages. At the beginning of the term, building the final rig was a desired deliverable but this has changed as Sailbot extended the project timeline and team members committed to working with them past the early April deadline. The design concept is complete for the final rig, though building and testing will take place through April and possibly into May. The finalized software deadline has also been extended with the evaluation of the Quark2, though we can still discuss the planned testing methods for each.

The finalized rig will contain a housing for the infrared camera (either the FLIR Lepton or Quark2), with electrical connections down to the hull of the boat. The exterior will have an extended conical lens protector to minimize splashes (already built and tested on Test Rig 2.0), an airflow shaper to add passive protection from water droplets (as discussed in the Theory section previously) as well as a loose, external windmill-like shell which can harness wind power to spin a wiper across the lens face. These components will be assembled and built mid April, with wind tunnel testing in the Rusty Hut pending for the end of April.

Moving forward with the software, integrating the IMU data with orientation tracking and horizone finding will be tested with the data sets obtained on the April 1 outing. Once the choice of infrared camera is finalized (and purchased, if the Quark2 is chosen) then our obstacle detection software will be refined by playing our existing test data through the pipeline and optimizing for identification at longer and longer distances; this is measured by timestamping when the software first identifies the object, and optimizing the code for the shortest timestamp.
